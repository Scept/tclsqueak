procedure partially taken from sdx